[%

    USE google = url('http://www.google.co.uk/search');

    query_base = "\"${candidate.name}\" ${candidate.party.name}";

    queries = [
        { "name and party"  => google( q => $query_base                   ) },        
#        { "contact details" => google( q => "$query_base contact details" ) },
    ];
    
#   FOREACH n IN [ 'email', 'phone', 'address', 'fax' ];
#        NEXT UNLESS candidate.$n;
#        query_title = "current $n";
#        queries.push( { $query_title => google( q => candidate.$n ) } );
#    END;
#
#    FOREACH l IN candidate.links;
#        queries.push( { ${l.title} => l.url } );
#    END;
    
    bad_detail_values = c.config.democracy_club.bad_detail_values;    

    total_points = c.session.dc_points.total_points || 0;
    leader_board = c.session.dc_points.leader_board || [];

%]
 <html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        [% PROCESS 'stubs/javascript.html',
            javascript_libraries => [ 'jquery', 'bad_details.js' ]
         %]
         <link rel="stylesheet" href="/static/css/bad_details.css" type="text/css" media="screen" title="no title" charset="utf-8">
    
        <title>Correct bad candidate details</title>
    </head>
    <body>
        <div id="header">
            <div id="instructions_wrapper">
                <div id="instructions">
                    Find the <strong>[% bad_detail.detail %]</strong> for:<br>
                    <strong>[% candidate.name | html %]</strong><br>
                    <small>[% candidate.party.name | html %]</small><br>
                    <small>([% candidate.seat_names | html %])</small><br>
                    for [% bad_detail_values.${bad_detail.detail} %] points.
                </div>
            </div>
        
            <div id="form_wrapper">
                [% form.render_start %]

                    <div class="fields_wrapper">                        
                        <div class="fields">                        
                        [% FOREACH f = form.fields %]
                            [% NEXT IF f.inactive %]
                            [% NEXT IF f.type == 'Submit' %]
                            [% f.render %]
                        [% END %]
                        </div>
                    </div>
                
                    <div class="buttons_wrapper">
                        <div class="buttons">
                        [% FOREACH f = form.fields %]
                            [% NEXT IF f.type != 'Submit' %]
                            [% f.render %]
                        [% END %]                            
                        </div>
                    </div>

               [% form.render_end %]
            </div>
            
            <div id="dc_scoreboard_wrapper">
                <a href="http://www.democracyclub.org.uk/" target="_blank" class="linkback">back to Democracy Club</a>                
                <h3>You now have <strong>[% total_points %]</strong> points!</h3>
                <a href="http://www.democracyclub.org.uk/duckhouse/" target="_blank"><img style="float: right;" alt="duckhouse" src="/static/duck-house.jpg" border="0"></a>
                <ul id="leaderboard">
                    <li><strong>Leaderboard</strong></li>
                    [% FOREACH l IN leader_board %]
                        <li>[% l.name | html %]</li>
                        [% LAST IF loop.count > 4 %]
                    [% END %]
                </ul>
            </div>
            <div class="clear"></div>
            
        </div>




        <div style="clear:both;height:100%;">
            <div id="explanation" [% 'style="display: none"' UNLESS show_explanation %]>
                <div>
                    <h1>Welcome!</h1>
                
                    <p>We need you to help us find contact details for the candidates so that we (and others) can contact them.</p>
                
                    <p>Above is a form to enter the details into.</p>
                    
                    <p>Under this notice is a Google search that might help you.</p>
                    
                    <button onclick="$('#explanation').fadeOut();" type="button">Return to game!</button>
                </div>
            </div>
 
            <iframe id="search-iframe" src="[% google( q => query_base ) %]" frameborder="0"></iframe>
        </div>

        [% PROCESS 'stubs/google_analytics.html' %]

    </body>
</html>
