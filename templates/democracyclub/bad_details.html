[%

    USE google = url('http://www.google.co.uk/search');

    query_base = "\"${candidate.name}\" ${candidate.party.name}";

    queries = [
        { "name and party"  => google( q => $query_base                   ) },        
        { "contact details" => google( q => "$query_base contact details" ) },
    ];
    
   FOREACH n IN [ 'email', 'phone', 'address', 'fax' ];
        NEXT UNLESS candidate.$n;
        query_title = "current $n";
        queries.push( { $query_title => google( q => candidate.$n ) } );
    END;

    FOREACH l IN candidate.links;
        queries.push( { ${l.title} => l.url } );
    END;
    
    bad_detail_values = c.config.democracy_club.bad_detail_values;    

    total_points = c.session.dc_points.total_points || 0;
    leader_board = c.session.dc_points.leader_board || [];

%]
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        [% PROCESS 'stubs/javascript.html',
            javascript_libraries => [ 'jquery', 'bad_details.js' ]
         %]
         <link rel="stylesheet" href="/static/css/bad_detail.css" type="text/css" media="screen" title="no title" charset="utf-8">
    
        <title>Correct bad candidate details</title>
    </head>
    <body>
        <table class="layout">
            <tr class="header">
                <td id="instructions">
                    <div>
                        Your next task is to find the <strong>[% bad_detail.detail %]</strong> for <strong>[% candidate.name | html %]</strong> - worth [% bad_detail_values.${bad_detail.detail} %] points.
                    </div>
                </td>

                <td id="main_content">
                    <div>
                        [% form.render_start %]
                        [% FOREACH f = form.fields %]
                            [% NEXT IF f.inactive %]
                            [% f.render %]

                        [% END %]

                        <ul id="extra_fields">
                            <li>Find for extra points:</li>
                        </ul>

                        [% form.render_end %]

                        Helpful searches: <select>
                            [% FOREACH q IN queries %]
                                [% q = q.pairs.0 %]
                                [% NEXT UNLESS q.value %]
                                <option onclick="open_in_iframe('[% q.value %]')">
                                    [% q.key || 'default' %]
                                </option>
                            [% END %]
                        </select>
                        
                    </div>
                </td>
                
                <td id="dc-scoreboard">

                    <h3>You now have <strong>[% total_points %]</strong> points!</h3>

                    <ul>
                        <li><strong>Leaderboard</strong></li>
                        [% FOREACH l IN leader_board %]
                            <li>[% l.name | html %]</li>
                            [% LAST IF loop.count > 4 %]
                        [% END %]
                    </ul>

                    <!-- <img style="float: right" width="128" height="77" alt="duckhouse" src="/static/duck-house.jpg"> -->

                </td>
                
            </tr>
            <tr>
                <td class="content" colspan=3>
                    [% IF show_explanation %]
                    <div id="explanation">
                        <div>
                        
                            <h1>Welcome!</h1>
                        
                            <p>We need you to help us find contact details for the candidates so that we (and others) can contact them.</p>
                        
                            <p>Above is a form to enter the details into.</p>
                            
                            <p>Under this notice is a Google search that might help you.</p>
                            
                            <button onclick="$('#explanation').fadeOut();">Thanks - let me get started!</button>
                        
                        </div>
                    </div>
                    [% END %]
                    <iframe id="search-iframe" src="[% google( q => query_base ) %]" frameborder="0"></iframe>
                </td>
            </tr>
        </table>

        [% PROCESS 'stubs/google_analytics.html' %]

    </body>
</html>

